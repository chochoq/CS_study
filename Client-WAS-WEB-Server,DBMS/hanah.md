# WAS / WS

출처)

[웹 프로그래밍(풀스택)](https://www.boostcourse.org/web316/lecture/16665/?isDesc=false)

[아파치, NginX, 톰캣이 뭔가요? (+ 웹서버, WAS, 로드밸런싱, 프록시)](https://www.youtube.com/watch?v=Zimhvf2B7Es)

# WAS(Web Application Server)

- Apache Tomcat, guinicorn
- 미들웨어의 하나
- 주요 3가지 기능
    - 프로그램 실행 환경과 데이터베이스 접속 기능을 제공
    - 여러 트랜잭션(논리적 작업 단위) 관리
    - 업무를 처리하는 비즈니스 로직 수행
- WAS도 보통 자체적으로 웹 서버 기능을 내장하고 있으며, 현재는 WAS가 가지고 있는 웹 서버도 정적인 콘텐츠를 처리하는데 있어서 성능 상 큰 차이가 없다.
- 웹 서버의 기능(정적인 컨텐츠 처리)도 제공하지만, 큰 규모의 서비스를 제공하는 현업에서는 **장애 극복 기능(failover)**을 위해 분리해서, 웹 서버를 WAS 앞 단에 두고 개발한다.
    - 규모가 커질수록, 자원 이용의 효율성 및 장애 극복, 배포 및 유지 보수의 편의성을 위해 웹 서버와 WAS를 대체로 분리한다.

## 장애 극복 기능

- 무중단 운영을 위해 필요
- 웹 서버는 WAS 보다 상대적으로 간단한 구조
- 다중 서버를 구성하여 운영하는 웹 어플리케이션의 경우, WAS에서 오류 발생 등 문제가 발생하여도, 앞단의 웹 서버에서 먼저 해당 WAS를 이용하지 못하도록 막고, WAS를 재시작하도록 하여, 클라이언트에서는 이러한 오류의 발생이 드러나지 않도록 한다.

## 미들웨어(MiddelWare)

- 클라이언트와 DBMS 사이에 또 다른 서버(미들웨어)를 두어, 비즈니스 로직의 동작을 미들웨어 서버에서 담당하도록 한다.

- 클라이언트는 입, 출력만 담당.

- 로직의 수정이 발생하는 경우, 중앙의 미들웨어만 변경하면 되므로, 클라이언트(예를 들면, 브라우저)의 재배포, 관리와 보안 등의 문제를 해결한다.

### Apache Tomcat

- 아파치 톰캣(Apache Tomcat)은 아파치 소프트웨어 재단(Apache Software Foundation, ASF)에서 개발한 세계에서 가장 많이 사용되는 WAS(Web Application Server)
- 자바를 이용하여 작성된 웹 어플리케이션은 WAS가 있어야만 실행할 수 있습니다.
- 아파치 톰캣은 오픈소스 소프트웨어로써 누구나 무료로 사용할 수 있습니다.
- 참고로 Tomcat은 '수고양이'
- 아파치 톰캣 설치 폴더 아래에 bin폴더를 보면 확장자가 bat인 윈도우용 배치파일과 확장자가 sh인 쉘스크립트(shell script)파일

- startup 파일로 실행, shutdown 파일로 종료 수행

- tomcat은 기본적으로 8080포트로 실행됩니다.

실행된 화면을 보면 "http-nio-8080"이라는 문자열을 볼 수 있는데 8080으로 실행되는 것을 표현하고 있는 것입니다.

- tomcat설정파일을 수정함으로써 실행되는 포트를 바꿀 수 있습니다.

### guinicorn

- Python 웹 서버 게이트웨이 인터페이스 (WSGI, Web Server Gateway Interface) 기반 HTTP 서버
- WSGI란 python으로 작성된 웹 어플리케이션과 python으로 작성된 서버 사이의 약속된 인터페이스 또는 규칙을 말한다.

# 웹 서버

- 웹 서버는 소프트웨어(Software) 혹은 웹 서버 소프트웨어가 동작하는 컴퓨터를 말한다.
- 웹 브라우저(클라이언트)의 요청을 받아 HTML 문서나 오브젝트를 반환한다.
- 웹 브라우저는 URL 주소에 해당하는 웹서버(Web Server)에 연결하고, 해당 주소에서 볼 수 있는 내용을 읽어 들인다.

- 먼저 HTML 파일을 읽어들여, 해석하면서 추가로 필요한 리소스들(css, js, 이미지 파일 등)을 웹 서버에 요청한다.

- 클라이언트와 웹 서버 간 통신은 보통 HTTP를 이용한다.

- URL 주소는 HTTP로 시작(이는, HTTP 통신을 사용하는 것을 의미함)

### 웹서버 소프트웨어

- 아파치, Nginx, 구글 웹서버, 마소 IIS(윈도우용 서버에 이용)

### Apache

Apache웹 서버는 Apache Software Foundation에서 개발한 웹서버로 오픈소스 소프트웨어(Open-source Software)이며, 거의 대부분 운영체제에서 설치 및 사용할 수 있다.

- MPM(멀티 프로세스 모듈), 즉 다중 프로세스/스레드를 이용한다. (mpm_prefork/ mpm_worker)
    - 다중 프로세스를 이용하며 컨텍스트 스위칭 등이 발생하므로, 자원 소모가 크다.
- 이벤트 기반 처리 방식도 추가되었다.
- 다양하고 검증된 기능이 필요한 경우 활용한다.

### Nginx

차세대 웹서버로 불리며 더 적은 자원으로 더 빠르게 데이터를 서비스하는 것을 목적으로 만들어진 서버이며 Apache웹 서버와 마찬가지로 오픈소스 소프트웨어다.

- event driven 방식
    - 순서대로 처리
- 성능과 가벼움, 효율성을 추구할 때 활용한다.

## Proxy Server

출처) 

[프록시 서버 - 위키백과, 우리 모두의 백과사전](https://ko.wikipedia.org/wiki/%ED%94%84%EB%A1%9D%EC%8B%9C_%EC%84%9C%EB%B2%84)

[[네트워크] 프록시 서버(Proxy Server)](https://yunyoung1819.tistory.com/9)

> 클라이언트가 자신을 통해서 다른 네트워크 서비스에 간접적으로 접속할 수 있게 해 주는 컴퓨터 시스템이나 응용 프로그램을 가리킨다. 
서버와 클라이언트 사이에 중계기로서 **대리로 통신을 수행**하는 것을 가리켜 '프록시', 그 중계 기능을 하는 것을 프록시 서버라고 부른다.
프록시 서버 중 일부는 프록시 서버에 요청된 내용들을 **캐시**를 이용하여 저장해 둔다. 이렇게 캐시를 해 두고 난 후에, 캐시 안에 있는 정보를 요구하는 요청에 대해서는 원격 서버에 접속하여 데이터를 가져올 필요가 없게 됨으로써 전송 시간을 절약할 수 있게 됨과 동시에 불필요하게 외부와의 연결을 하지 않아도 된다는 장점을 갖게 된다. 
또한 외부와의 트래픽을 줄이게 됨으로써 **네트워크 병목 현상을 방지**하는 효과도 얻을 수 있게 된다.

- 보안 목적

    보안 분야에서는 주로 보안상의 이유 등으로 직접 통신할 수 없는 경우가 존재한다. 이런 경우 직접 통신할 수 없는 두 점 사이에서 대리로 통신을 수행하는 기능을 프록시, 그 중계 기능을 하는 것을 프록시 서버라고 한다. 즉 시스템에 방화벽을 가지고 있는 경우 외부와의 통신을 위해 만들어 놓은 서버다.

- 로드밸런싱 기능

    WAS를 여러 대 구동하는 경우, 클라이언트를 내부 서버에 균형적으로 연결하도록 돕는다. 서버의 장애 극복이나, 무중단 배포를 위해서 활용된다.

- 캐싱 기능

    프록시 서버는 보안 상의 목적으로 설치되는 경우가 많으나, 단순히 보안 상의 이유만으로 설치되는 것은 아니다. 캐시 기능을 이용하여 통신 효율을 높이는 목적도 있다.

### Forward Proxy

클라이언트가 우회 접속을 위해 IP를 바꾸기 위한 용도로 많이 사용되고 있다.

프록시 서버를 '클라이언트 호스트들과 접근하고자 하는 원격 리소스의 사이'에 위치시킨다. 즉 사용자가 naver.com에 연결하려고 하면 사용자가 PC에 직접 연결하는 것이 아니라 Forward 프록시 서버가 요청을 받아 naver.com에 연결하여 그 결과를 사용자에게 전달해준다.

이 서버는 전형적으로 로컬 디스크에 데이터를 저장하며, 클라이언트 호스트들은 사용 중인 웹 브라우저를 이용하여 프록시 서버 사용 설정을 해야 하므로 프록서 서버를 사용하고 있다는 것을 인식할 수 있다.

### Reverse Proxy


웹 서버는 리버스 프록시 방식으로 서비스를 제공한다.

프록시 서버를 '인터넷 리소스 또는 인트라넷 리소스 앞'에 위치시키는 방식, 즉 사용자가 [naver.com](http://naver.com/) 웹 서비스에 데이터를 요청하면, Rerverse 프록시가 이 요청을 받아 내부 서버(WAS)에서 데이터를 받은 후에 이 데이터를 사용자에게 전달하는 방식이다.

이 방식을 사용하면 클라이언트들이 프록시 서버에 연결되었다는 것을 인식하지 못하며, 마치 최종 사용자가 요청 리소스에 직접 접근하는 것과 같이 느껴진다.

내부 서버가 직접 서비스를 제공해도 되지만 이렇게 구성하는 이유는 보안 때문이다. 보통 기업의 네트워크 환경은 DMZ 라고 하는 내부 네트워크와 외부 네트워크 사이에 위치하는 구간이 존재하며 이 구간에는 메일 서버, 웹 서버, FTP 서버 등 외부 서비스를 제공하는 서버가 위치하게 된다.

서비스를 자바로 구현해서 WAS를 DMZ에 놓고 서비스해도 되지만 WAS는 보통 DB 서버와 연결되므로 WAS가 최전방에 있으면 WAS가 해킹당할 경우 DB서버까지 같이 해킹되는 심각한 문제가 발생할 수 있다. 이 때문에 리버스 프록시 서버를 두고 실제 서비스 서버는 내부망에 위치시키고 프록시 서버만 내부에 있는 서비스 서버와 통신해서 결과를 클라이언트에게 제공하는 방식으로 서비스를 하게 된다.

특히 리눅스 환경에서는 리버스 프록시로 아파치 웹 서버를 사용한다면 SELinux를 켜놓으면 SELinux의 기본 정책이 웹 서버는 톰캣의 8080, 8009 포트만 접근할 수 있으므로 아파치 웹 서버가 해킹당해도 웹 서버 권한으로는 내부망 연결이 불가능하다.

리버스 프록시 방식은 각 요청에 대한 데이터가 캐시되기 때문에 프록시 서버는 실제 서버들을 위한 부하 조절 기능을 가질 수 있다.

# CGI(Common Gateway Interface)

> 공용 게이트웨이 인터페이스는 웹 서버 상에서 사용자 프로그램을 동작시키기 위한 조합이다. 존재하는 많은 웹 서버 프로그램은 CGI의 기능을 이용할 수 있다. 웹 서버 프로그램의 기능의 주체는 미리 준비된 정보를 이용자의 요구에 응답해 보내는 것이다. ([https://ko.wikipedia.org/wiki/공용_게이트웨이_인터페이스](https://ko.wikipedia.org/wiki/%EA%B3%B5%EC%9A%A9_%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4_%EC%9D%B8%ED%84%B0%ED%8E%98%EC%9D%B4%EC%8A%A4))

- 웹 서버에서 동적인 프로그래밍 기능이 들어가는 서비스 방식
